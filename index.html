import React, { useState, useEffect, useRef } from 'react';
import { Volume2, VolumeX, Play, Pause, SkipBack, SkipForward, Eye, Music } from 'lucide-react';

export default function BioWebsite() {
  const [audioPlaying, setAudioPlaying] = useState(false);
  const [volume, setVolume] = useState(45);
  const [currentTime, setCurrentTime] = useState(0);
  const [duration, setDuration] = useState(0);
  const [progress, setProgress] = useState(0);
  const [showOverlay, setShowOverlay] = useState(true);
  const audioRef = useRef(null);
  const canvasRef = useRef(null);

  useEffect(() => {
    // Initialize audio
    if (audioRef.current) {
      audioRef.current.volume = volume / 100;
    }

    // Plasma effect setup
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    let animationId;
    let time = 0;

    const resize = () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    };
    resize();
    window.addEventListener('resize', resize);

    const drawPlasma = () => {
      const w = canvas.width;
      const h = canvas.height;
      const imageData = ctx.createImageData(w, h);
      const data = imageData.data;

      for (let y = 0; y < h; y += 4) {
        for (let x = 0; x < w; x += 4) {
          const value = Math.sin(x * 0.01 + time) +
                       Math.sin(y * 0.01 + time) +
                       Math.sin((x + y) * 0.01 + time);
          
          const color = Math.floor((value + 3) * 42.5);
          const idx = (y * w + x) * 4;
          
          // Purple/pink plasma effect
          data[idx] = Math.min(255, color * 1.5);
          data[idx + 1] = Math.min(255, color * 0.3);
          data[idx + 2] = Math.min(255, color * 1.8);
          data[idx + 3] = Math.min(255, color * 0.3);
        }
      }

      ctx.putImageData(imageData, 0, 0);
      time += 0.03;
      animationId = requestAnimationFrame(drawPlasma);
    };

    drawPlasma();

    return () => {
      window.removeEventListener('resize', resize);
      cancelAnimationFrame(animationId);
    };
  }, []);

  useEffect(() => {
    if (audioRef.current) {
      audioRef.current.volume = volume / 100;
    }
  }, [volume]);

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
  };

  const handlePlayPause = () => {
    if (audioRef.current) {
      if (audioPlaying) {
        audioRef.current.pause();
      } else {
        audioRef.current.play();
      }
      setAudioPlaying(!audioPlaying);
    }
  };

  const handleTimeUpdate = () => {
    if (audioRef.current) {
      setCurrentTime(audioRef.current.currentTime);
      setDuration(audioRef.current.duration);
      setProgress((audioRef.current.currentTime / audioRef.current.duration) * 100);
    }
  };

  const handleProgressChange = (e) => {
    const newProgress = parseFloat(e.target.value);
    setProgress(newProgress);
    if (audioRef.current) {
      audioRef.current.currentTime = (newProgress / 100) * audioRef.current.duration;
    }
  };

  const handleSkip = (seconds) => {
    if (audioRef.current) {
      audioRef.current.currentTime += seconds;
    }
  };

  const hideOverlay = () => {
    setShowOverlay(false);
    if (audioRef.current) {
      audioRef.current.play();
      setAudioPlaying(true);
    }
  };

  return (
    <div className="min-h-screen bg-black text-white font-['Poppins',sans-serif] relative overflow-hidden">
      {/* Plasma Background */}
      <canvas ref={canvasRef} className="fixed inset-0 pointer-events-none opacity-50" style={{ zIndex: -1 }} />

      {/* Audio Element */}
      <audio
        ref={audioRef}
        loop
        onTimeUpdate={handleTimeUpdate}
        onLoadedMetadata={handleTimeUpdate}
      >
        <source src="./assets/music.mp3" type="audio/mpeg" />
      </audio>

      {/* Overlay */}
      {showOverlay && (
        <div 
          className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 cursor-pointer transition-opacity duration-300"
          onClick={hideOverlay}
        >
          <p className="text-2xl">Click to enter</p>
        </div>
      )}

      {/* Audio Control */}
      <div className="fixed top-6 right-6 flex items-center gap-3 bg-black bg-opacity-30 backdrop-blur-sm px-4 py-2 rounded-full border border-white border-opacity-10 z-40">
        <button onClick={() => setVolume(volume === 0 ? 45 : 0)} className="text-purple-400 hover:text-purple-300 transition">
          {volume === 0 ? <VolumeX size={20} /> : <Volume2 size={20} />}
        </button>
        <input
          type="range"
          min="0"
          max="100"
          value={volume}
          onChange={(e) => setVolume(parseFloat(e.target.value))}
          className="w-24 h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer"
          style={{
            background: `linear-gradient(to right, #a855f7 0%, #a855f7 ${volume}%, #374151 ${volume}%, #374151 100%)`
          }}
        />
      </div>

      {/* Main Content */}
      <div className="container mx-auto px-4 py-12 max-w-2xl relative z-10">
        {/* Profile Info */}
        <div className="flex items-center justify-center gap-2 mb-8 text-sm text-gray-400">
          <Eye size={16} />
          <span>954</span>
        </div>

        {/* Avatar & Name */}
        <div className="flex flex-col items-center mb-8 space-y-4">
          <div className="w-32 h-32 rounded-full overflow-hidden border-4 border-purple-500 shadow-lg shadow-purple-500/50">
            <img 
              src="./assets/avatar.jpg" 
              alt="Rio" 
              className="w-full h-full object-cover"
              onError={(e) => e.target.src = 'https://via.placeholder.com/128?text=Rio'}
            />
          </div>
          
          <h1 className="text-4xl font-bold bg-gradient-to-r from-purple-400 via-pink-400 to-purple-400 bg-clip-text text-transparent animate-pulse">
            Rio
          </h1>

          {/* Badges */}
          <div className="flex gap-3">
            <div className="text-purple-400 hover:scale-110 transition" title="OG">
              <svg width="24" height="24" fill="currentColor" viewBox="0 0 499.541 499.541">
                <path d="m321.984 287.552-43.008 211.989c.085-.149.235-.213.299-.363L416.15 225.429zm89.024-84.288L250.325 2.411 318.933 264zM227.648 0 83.392 270.421h215.189zM84.843 291.755l172.906 204.992 41.6-204.992z"/>
              </svg>
            </div>
            <div className="text-purple-400 hover:scale-110 transition" title="Premium">
              <svg width="24" height="24" fill="currentColor" viewBox="0 0 47.05 47.05">
                <path d="M43.656 16.983c-.73-2.255.267-5.41-1.1-7.287-1.379-1.895-4.699-1.915-6.594-3.295-1.876-1.365-2.914-4.523-5.168-5.255-2.174-.706-4.859 1.216-7.271 1.216-2.41 0-5.097-1.922-7.271-1.216-2.254.731-3.292 3.89-5.169 5.255-1.895 1.38-5.213 1.4-6.592 3.295-1.365 1.877-.369 5.032-1.1 7.287C2.685 19.157 0 21.114 0 23.525s2.686 4.367 3.393 6.542c.73 2.254-.267 5.41 1.1 7.287 1.379 1.896 4.698 1.915 6.593 3.294 1.876 1.366 2.914 4.524 5.168 5.257 2.175.705 4.86-1.217 7.271-1.217s5.097 1.922 7.271 1.217c2.254-.731 3.292-3.891 5.168-5.256 1.896-1.379 5.214-1.399 6.595-3.295 1.364-1.876.367-5.032 1.098-7.286.707-2.175 3.394-4.133 3.394-6.542-.003-2.412-2.688-4.368-3.395-6.543M23.524 40.031c-9.102 0-16.507-7.403-16.507-16.506 0-9.102 7.405-16.507 16.507-16.507s16.507 7.405 16.507 16.507-7.405 16.506-16.507 16.506"/>
              </svg>
            </div>
          </div>

          {/* Social Links */}
          <div className="flex gap-4">
            <a 
              href="https://open.spotify.com/user/31rkvrg76kye7zgeg6ffogxciwhq?si=727710faab9b4675"
              target="_blank"
              rel="noopener noreferrer"
              className="text-purple-400 hover:text-purple-300 transition hover:scale-110"
              title="Spotify"
            >
              <Music size={24} />
            </a>
            <a 
              href="https://www.roblox.com/users/10168827977/profile"
              target="_blank"
              rel="noopener noreferrer"
              className="text-purple-400 hover:text-purple-300 transition hover:scale-110"
              title="Roblox"
            >
              <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                <path d="M18.926 23L5.074 1 1 5.074 14.852 23z"/>
              </svg>
            </a>
          </div>
        </div>

        {/* Scroll Indicator */}
        <div className="text-center mb-12 text-gray-400 text-sm animate-bounce">
          <p>Scroll for more</p>
          <div className="mt-2">â†“</div>
        </div>

        {/* About Section */}
        <div className="mb-8">
          <h2 className="text-2xl font-bold mb-4 text-center">About Me</h2>
          <div className="bg-black bg-opacity-30 backdrop-blur-sm p-6 rounded-2xl border border-purple-500 border-opacity-20 shadow-lg shadow-purple-500/20">
            <p className="text-gray-300 text-center text-lg">Stay up</p>
          </div>
        </div>

        {/* Discord Card */}
        <div className="mb-8 bg-black bg-opacity-30 backdrop-blur-sm p-6 rounded-2xl border border-purple-500 border-opacity-20 shadow-lg shadow-purple-500/20">
          <div className="flex items-center gap-4">
            <div className="relative">
              <div className="w-16 h-16 rounded-full overflow-hidden border-2 border-purple-500">
                <img 
                  src="./assets/discord-avatar.jpg" 
                  alt="Discord"
                  className="w-full h-full object-cover"
                  onError={(e) => e.target.src = 'https://via.placeholder.com/64?text=DC'}
                />
              </div>
              <div className="absolute -bottom-1 -right-1 w-5 h-5 bg-red-500 rounded-full border-2 border-black" title="Do Not Disturb" />
            </div>
            <div className="flex-1">
              <h3 className="font-semibold text-lg">rio</h3>
              <p className="text-sm text-gray-400">Discord ID: 1426753808968716338</p>
            </div>
          </div>
        </div>

        {/* Music Player */}
        <div className="bg-black bg-opacity-30 backdrop-blur-sm p-6 rounded-2xl border border-purple-500 border-opacity-20 shadow-lg shadow-purple-500/20">
          <div className="flex items-center gap-4 mb-4">
            <div className="w-16 h-16 rounded-lg overflow-hidden border-2 border-purple-500">
              <img 
                src="./assets/album-cover.jpg" 
                alt="Album"
                className="w-full h-full object-cover"
                onError={(e) => e.target.src = 'https://via.placeholder.com/64?text=Music'}
              />
            </div>
            <div className="flex-1">
              <h3 className="font-semibold">Now Playing</h3>
              <p className="text-sm text-gray-400">Your favorite track</p>
            </div>
          </div>
          
          <div className="space-y-3">
            <div className="flex items-center gap-2 text-sm text-gray-400">
              <span>{formatTime(currentTime)}</span>
              <input
                type="range"
                min="0"
                max="100"
                value={progress}
                onChange={handleProgressChange}
                className="flex-1 h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer"
                style={{
                  background: `linear-gradient(to right, #a855f7 0%, #a855f7 ${progress}%, #374151 ${progress}%, #374151 100%)`
                }}
              />
              <span>{formatTime(duration)}</span>
            </div>
            
            <div className="flex items-center justify-center gap-4">
              <button 
                onClick={() => handleSkip(-5)}
                className="text-purple-400 hover:text-purple-300 transition"
              >
                <SkipBack size={20} />
              </button>
              <button 
                onClick={handlePlayPause}
                className="bg-purple-500 hover:bg-purple-600 p-3 rounded-full transition"
              >
                {audioPlaying ? <Pause size={20} /> : <Play size={20} />}
              </button>
              <button 
                onClick={() => handleSkip(5)}
                className="text-purple-400 hover:text-purple-300 transition"
              >
                <SkipForward size={20} />
              </button>
            </div>
          </div>
        </div>
      </div>

      <style jsx>{`
        input[type="range"]::-webkit-slider-thumb {
          appearance: none;
          width: 12px;
          height: 12px;
          border-radius: 50%;
          background: #a855f7;
          cursor: pointer;
        }
        input[type="range"]::-moz-range-thumb {
          width: 12px;
          height: 12px;
          border-radius: 50%;
          background: #a855f7;
          cursor: pointer;
          border: none;
        }
      `}</style>
    </div>
  );
}
